[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "pilot"
version = "0.1.0"
description = "Pilot project"
dependencies = [
    "flwr[simulation]>=1.22.0",
    "ray>=2.0.0",
    "pandas>=2.1.0",
    "torch==2.8.0",
    "torchvision==0.23.0",
    "tqdm",
    "transformers",
    "peft",
    "trl",
    "wandb",

    # medAlpaca dependencies
    "accelerate",
    "appdirs",
    "datasets",
    "fire",
    "gradio",
    "sentencepiece",
    # "bitsandbytes",  # only required for 4-bit or 8-bit quantization
]

[project.optional-dependencies]
dev = [
    "black>=25.1.0",
    "isort>=6.0.1",
    "pre-commit>=4.1.0",
    "ruff>=0.9.7",
]
test = [
    "pytest>=8.3.5",
    "pytest-cov>=6.0.0",
]

[tool.hatch.build.targets.wheel]
packages = ["."]

[tool.flwr.app]
publisher = "flwrlabs"

[tool.flwr.app.components]
serverapp = "pilot.server_app:app"
clientapp = "pilot.client_app:app"

[tool.flwr.app.config]
model_type = "simple_cnn"
dataset_name = "uoft-cs/cifar10"
num_shards = 5
num_rounds = 100
# local_batches = 100
lr = 0.1
batch_size = 32
wandb_enabled = true
wandb_project = "pilot_flwr"
# wandb_entity = ""  # Optional wandb username / team name
# round_interval_seconds = 300
# server_debug_port = 5681
# client_debug_port = 5682

[tool.flwr.federations]
default = "local-simulation"

[tool.flwr.federations.local-simulation]
options.num-supernodes = 3

[tool.flwr.federations.local-simulation-gpu]
options.num-supernodes = 1
options.backend.client-resources.num-gpus = 0.3

[tool.flwr.federations.local-deployment]
address = "127.0.0.1:9093"
insecure = true
